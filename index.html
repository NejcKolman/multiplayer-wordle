<html>

<head>
    <link rel="stylesheet" href="css/landing.css" />
</head>

<body>
    <input type="text" id='inputText' autofocus placeholder="Enter word" autofocus
        onkeyup="updateNovaBeseda(this.value)" maxlength="5">



    <div>
        Hide the word: <input type="checkbox" id="myCheck" onclick="hide()">
    </div>
    <select id="language" onchange="updateLanguage(this.value)">
        <option value="eng"> ENG </option>
        <option value="slo"> SLO </option>
    </select>
    <button id="copyLink" onclick="copyLink()" style='display:none'>
        Copy link
    </button>
    <a id="link"></a>
    <button id="randomWord" onclick="pickRandomWord()">
        Random word
    </button>
    <script>


        function copyLink() {
            navigator.clipboard.writeText(link)
        }



        async function fetchWords(language) {
            let response = await fetch("data/besede/" + language + ".txt")
            let words = await response.text()
            return words.toLowerCase().split('\n')
        }
        let ALL_WORDS = []
        let VSE_BESEDE = []
        async function preloadWords() {
            const word_lists = await Promise.all([fetchWords("slo"), fetchWords("eng")]);
            VSE_BESEDE = word_lists[0];
            ALL_WORDS = word_lists[1];
            new_VseBesede = []
            new_AllWords = []
            for (let i = 0; i < VSE_BESEDE.length; i++) {
                word = VSE_BESEDE[i]
                if (word.length == 5) {
                    new_VseBesede.push(word)
                }
            }
            for (let i = 0; i < ALL_WORDS.length; i++) {
                word = ALL_WORDS[i]
                if (word.length == 5) {
                    new_AllWords.push(word)
                }
            }
            VSE_BESEDE = new_VseBesede
            ALL_WORDS = new_AllWords
        }
        preloadWords()

        let jezik = 'eng'
        let beseda = '_'
        function updateShareLink() {
            if (beseda.length == 5) {
                if (jezik == 'eng' && ALL_WORDS.includes(beseda) == false) {
                    link.removeAttribute('href')
                    document.getElementById("link").innerHTML = 'The word is not in the word list!'
                    document.getElementById('copyLink').setAttribute('style', 'display:none')
                } else if (jezik == 'slo' && VSE_BESEDE.includes(beseda) == false) {
                    link.removeAttribute('href')
                    document.getElementById("link").innerHTML = 'Beseda ni v seznamu besed!'
                    document.getElementById('copyLink').setAttribute('style', 'display:none')
                } else {
                    encoded = btoa(escape(beseda))
                    const url = "play.html?beseda=" + encoded + '&language=' + jezik;
                    const link = document.getElementById("link");
                    link.href = url
                    link.innerHTML = url;
                    document.getElementById('copyLink').removeAttribute('style')
                }
            }

            else {
                link.removeAttribute('href')
                document.getElementById("link").innerHTML = 'Beseda mora biti dolga 5 znakov'
                document.getElementById('copyLink').setAttribute('style', 'display:none')
            }
        }
        function updateNovaBeseda(novaBeseda) {
            beseda = novaBeseda.toLowerCase()
            updateShareLink()
        }
        function updateLanguage(language) {
            jezik = language
            updateShareLink()
        }


        function hide() {
            isHidden = document.getElementById('myCheck').checked
            if (isHidden == true) {
                document.getElementById('inputText').type = 'password'
            }
            else document.getElementById('inputText').type = 'text'
        }

        function pickRandomWord() {
            if (jezik == 'eng') {
                WL = ALL_WORDS
            }
            else if (jezik == 'slo') {
                WL = VSE_BESEDE
            }

            randomWord = WL[Math.floor(Math.random() * (WL.length))]
            console.log(randomWord)
            document.getElementById('inputText').value = randomWord
            updateNovaBeseda(randomWord)
        }
    </script>
</body>

</html>