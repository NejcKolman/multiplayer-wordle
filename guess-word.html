<html>

<head>

</head>

<body>
    <input type="text" id="myGuess" onchange="guess()" minlength="5" maxlength="5" placeholder="guess">
    <span id="result"></span>

    <p id="warning"></p>


    <table id='guesses'>


    </table>

    <script>
        const params = new URLSearchParams(window.location.search)
        encoded = params.get('beseda')
        toGuess = atob(encoded).toUpperCase()

        //display:none; block
        //loči logiko od grafike. Dve funkciji
        function guess() {
            myGuess = document.getElementById("myGuess").value.toUpperCase()

            console.log(myGuess)
            if (myGuess.length != 5) {
                document.getElementById('warning').innerHTML = 'Beseda mora imeti 5 črk!'
                return
            }
            document.getElementById('warning').innerHTML = ''


            const matchingLetters = getMatches(myGuess, toGuess)
            showNewGuessRow(matchingLetters)


        }


        function getMatches(myGuess, toGuess) {
            let greenLetters = {}
            let greyLetters = {}
            let yellowLetters = {}
            let unguessed = {}
            for (let i = 0; i < 5; i++) {
                let letter = myGuess[i]
                if (letter == toGuess[i]) {
                    greenLetters[i] = letter

                } else if (toGuess.includes(letter) == false) {
                    greyLetters[i] = letter
                    unguessed[i] = toGuess[i]
                } else { unguessed[i] = toGuess[i] }

            }

            for (let i = 0; i < 5; i++) {

                let letter = myGuess[i]
                if (i in greenLetters || i in greyLetters) {
                    continue
                }
                console.log(i)
                let isYellow = false
                console.log(unguessed)
                for (const [key, value] of Object.entries(unguessed)) {
                    if (value == letter && isYellow == false) {
                        yellowLetters[i] = letter
                        delete unguessed[key]
                        isYellow = true
                    }
                }

                if (isYellow == false) {
                    greyLetters[i] = letter
                }
            }


            return [greenLetters, greyLetters, yellowLetters]
        }

        function showNewGuessRow(matchingLetters) {
            let [greenLetters, greyLetters, yellowLetters] = matchingLetters
            let tr = document.createElement('tr')

            for (let i = 0; i < 5; i++) {
                let td = document.createElement('td')
                if (i in greenLetters) {
                    td.append(greenLetters[i])
                    td.style.color = 'green'
                } else if (i in greyLetters) {
                    td.append(greyLetters[i])
                    td.style.color = 'grey'
                } else {
                    td.append(yellowLetters[i])
                    td.style.color = 'yellow'
                }

                tr.append(td)

            }
            document.getElementById('guesses').append(tr)
        }
    </script>
</body>

</html>